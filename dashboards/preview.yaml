decluttering_templates: !include "../decluttering_templates.yaml"
title: Dashboard Principal
views:
  ########################################
  # Apercu
  ########################################
  - title: Aperçu
    type: custom:grid-layout
    layout:
      grid-template-columns: 1fr 1fr 1fr 1fr
      grid-template-rows: auto auto auto auto auto
      grid-template-areas: |-
        "z z z z"
        "x x x x"
        "y y y y"
        "a a b b"
        "e f g h"
      place-content: stretch
    cards:   
      - type: horizontal-stack
        cards:    
          - type: custom:mushroom-person-card
            entity: person.cha
            icon_type: entity-picture
            badge_icon: |
              {% if is_state('input_select.cha', 'Home') %}
                mdi:home
              {% elif is_state(config.entity, 'away') or
                      is_state(config.entity, 'unavailable') %}
                mdi:map-marker-question-outline
              {% endif %}  
            badge_color: |-
              {% if is_state('input_select.cha', 'Home') %}
                green
              {% else %}
                red
              {% endif %}     
          - type: custom:mushroom-person-card 
            entity: person.kaeko
            icon_type: entity-picture
            badge_icon: |
              {% if is_state('input_select.cha', 'Home') %}
                mdi:home
              {% elif is_state(config.entity, 'away') or
                      is_state(config.entity, 'unavailable') %}
                mdi:map-marker-question-outline
              {% endif %}  
            badge_color: |-
              {% if is_state('input_select.cha', 'Home') %}
                green
              {% else %}
                red
              {% endif %}             
        view_layout:
          grid-area: z 
      - type: horizontal-stack
        cards:
        - type: custom:button-card
          name: |
              <ha-icon icon="mdi:floor-plan"></ha-icon> Rez-de-chaussée
          template: details
          tap_action:
            action: navigate
            navigation_path: /floorplan-rdc-dashboard/floorplan 
          styles:
            card:
              - height: 60px
              - width: 200px  
        - type: custom:button-card
          name: |
              <ha-icon icon="mdi:floor-plan"></ha-icon> Etage
          template: details
          tap_action:
            action: navigate
            navigation_path: /floorplan-etage-dashboard/floorplan    
          styles:
            card:
              - height: 60px
              - width: 200px                        
        - type: custom:button-card
          name: |
              <ha-icon icon="mdi:thermometer"></ha-icon> Températures
          template: details
          tap_action:
            action: navigate
            navigation_path: /preview-dashboard/subview-temperatures    
          styles:
            card:
              - height: 60px
              - width: 200px  
        - type: custom:button-card
          name: |
              <ha-icon icon="mdi:lightning-bolt"></ha-icon> Energie
          template: details
          tap_action:
            action: navigate
            navigation_path: /preview-dashboard/subview-energie    
          styles:
            card:
              - height: 60px
              - width: 200px   
        view_layout:
          grid-area: x                           
      - type: custom:hourly-weather
        entity: weather.forecast_maison
        num_segments: 24 # optional, defaults to 12
        name: Prochaines 24h # optional, defaults to "Hourly Weather"
        show_wind: true
        view_layout:
          place-self: center stretch
          grid-area: y  
        tap_action:
          action: navigate
          navigation_path: /preview-dashboard/2        
      - type: markdown
        title: Ecran large
        content: |
          {% for i in range(0, 5 ) %}
            <ha-alert alert-type="info">{{ states.sensor.ecran_large_rss.attributes.entries[i].title }}</br> [Lien]({{ states.sensor.ecran_large_rss.attributes.entries[i].link }})</ha-alert>
          {% endfor %}
            D'autres articles sur [Ecran Large](https://www.ecranlarge.com/)
        view_layout:
          place-self: stretch stretch
          grid-area: e              
      - type: markdown
        title: Journal du Geek
        content: |
          {% for i in range(0, 5 ) %}
            <ha-alert alert-type="info">{{ states.sensor.journal_du_geek_rss.attributes.entries[i].title }}</br> [Lien]({{ states.sensor.journal_du_geek_rss.attributes.entries[i].link }})</ha-alert>
          {% endfor %}
            D'autres articles sur [Journal du Geek](https://www.journaldugeek.com/)
        view_layout:
          place-self: cestretchnter stretch
          grid-area: f              
      - type: markdown
        title: Jeux vidéos
        content: |
          {% for i in range(0, 5 ) %}
            <ha-alert alert-type="info">{{ states.sensor.jeux_videos_rss.attributes.entries[i].title }}</br> [Lien]({{ states.sensor.jeux_videos_rss.attributes.entries[i].link }})</ha-alert>
          {% endfor %}
            D'autres articles sur [Jeux Vidéos](https://www.jeuxvideo.com/)                                    
        view_layout:
          place-self: stretch stretch
          grid-area: g  
      - type: markdown
        title: Les alexiens
        content: |
          {% for i in range(0, 5 ) %}
            <ha-alert alert-type="info">{{ states.sensor.les_alexiens_rss.attributes.entries[i].title }}</br> [Lien]({{ states.sensor.les_alexiens_rss.attributes.entries[i].link }})</ha-alert>
          {% endfor %}
            D'autres articles sur [Les alexiens](https://www.lesalexiens.fr/)
        view_layout:
          place-self: stretch stretch
          grid-area: h                          
  #################################################
  # Securité
  #################################################
  - title: Securité
    type: custom:grid-layout
    layout:
      grid-template-columns: 1fr 1fr 1fr
      grid-template-rows: auto auto auto
      grid-template-areas: |-
        "z z z"
        "a b c"
        "d e f"
      place-content: stretch
      mediaquery:
          grid-template-columns: 1fr
          grid-template-areas: |-
            "a"
            "b"
            "c"
            "d"
    cards:   
      - type: horizontal-stack
        cards:    
          - type: custom:mushroom-person-card
            entity: person.cha
            icon_type: entity-picture
            badge_icon: |
              {% if is_state('input_select.cha', 'Home') %}
                mdi:home
              {% elif is_state(config.entity, 'away') or
                      is_state(config.entity, 'unavailable') %}
                mdi:map-marker-question-outline
              {% endif %}  
            badge_color: |-
              {% if is_state('input_select.cha', 'Home') %}
                green
              {% else %}
                red
              {% endif %}     
          - type: custom:mushroom-person-card 
            entity: person.kaeko
            icon_type: entity-picture
            badge_icon: |
              {% if is_state('input_select.cha', 'Home') %}
                mdi:home
              {% elif is_state(config.entity, 'away') or
                      is_state(config.entity, 'unavailable') %}
                mdi:map-marker-question-outline
              {% endif %}  
            badge_color: |-
              {% if is_state('input_select.cha', 'Home') %}
                green
              {% else %}
                red
              {% endif %}             
        view_layout:
          grid-area: z       
      - type: grid
        square: false
        columns: 1
        cards:
          - type: picture-entity
            show_state: true
            show_name: true
            camera_view: live
            entity: camera.cam_hall_high
            camera_image: camera.cam_hall_high
            tap_action:
              action: none
          - type: entities
            entities:
              - entity: switch.cam_hall_privacy_mode
              - entity: select.cam_hall_recording_mode
              - entity: binary_sensor.cam_hall_is_dark
        view_layout:
          grid-area: a      
      - type: grid
        square: false
        columns: 1
        cards:
          - type: picture-entity
            show_state: true
            show_name: true
            camera_view: live
            entity: camera.cam_stairs_high
            camera_image: camera.cam_stairs_high
            tap_action:
              action: none
          - type: entities
            entities:
              - entity: switch.cam_stairs_privacy_mode
              - entity: select.cam_stairs_recording_mode
              - entity: binary_sensor.cam_stairs_is_dark
        view_layout:
          place-self: center stretch
          grid-area: b               
      - type: grid
        square: false
        columns: 1
        cards:
          - type: picture-entity
            show_state: true
            show_name: true
            camera_view: live
            entity: camera.cam_living_high
            camera_image: camera.cam_living_high
            tap_action:
              action: none
          - type: entities
            entities:
              - entity: switch.cam_living_privacy_mode
              - entity: select.cam_living_recording_mode
              - entity: binary_sensor.cam_living_is_dark     
        view_layout:
          grid-area: c   
      - type: entities
        show_header_toggle: false
        entities:
          - type: section
            label: Accès extérieur               
          - type: custom:decluttering-card
            template: door
            variables:
              - entity: binary_sensor.sonoff_a480085c50
              - name: Porte d'entrée       
          - type: custom:decluttering-card
            template: door
            variables:
              - entity: binary_sensor.sonoff_a48007e0ab
              - name: Porte Terrasse     
          - type: custom:decluttering-card
            template: door
            variables:
              - entity: binary_sensor.sonoff_a4800866c1
              - name: Fenêtre gauche    
        view_layout:
          grid-area: d                                                       
  #################################################
  # Meteo
  #################################################
  - title: Meteo          
    type: custom:grid-layout
    layout:
      grid-template-columns: repeat(4, 1fr)
      grid-template-rows: auto auto auto auto
      grid-template-areas: |-
        "z z z z"
        "y y y y"
        "a b b b"
        "c b b b"
        "d e f g"
      place-content: stretch
    cards: 
    - type: custom:hourly-weather
      entity: weather.forecast_maison
      num_segments: 24 # optional, defaults to 12
      name: Prochaines 24h # optional, defaults to "Hourly Weather"
      show_wind: true
      view_layout:
        place-self: center stretch
        grid-area: z
    - type: horizontal-stack
      cards:
        - type: entities
          entities:
            - entity: sensor.next_sunrise
              name: Lever du soleil
            - entity: sensor.next_sunset
              name: Coucher du soleil
        - type: entities
          entities:
            - entity: sensor.ws2900_v2_02_01_max_daily_gust
              name: Rafale maximale 
            - entity: sensor.ws2900_v2_02_01_total_rain
              name: Pluie totale    
      view_layout:
        grid-area: y
    - type: custom:weather-chart-card
      entity: weather.forecast_maison
      show_main: false
      show_current_condition: false
      show_attributes: false
      animated_icons: true
      units:
        speed: km/h 
      view_layout:
        place-self: center stretch
        grid-area: a             
    - type: iframe
      aspect_ratio: 50%
      url: "https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=default&metricTemp=default&metricWind=default&zoom=7&overlay=wind&product=ecmwf&level=surface&lat=50.17&lon=4.329&pressure=true&message=true"              
      view_layout:
        place-self: center stretch
        grid-area: b  
    - type: custom:apexcharts-card
      config_templates:
        - meteo
      header:
        show: true
        show_states: true
        colorize_states: true
      graph_span: 36h
      all_series_config:
        stroke_width: 1
      series:
        - entity: sensor.ws2900_v2_02_01_outdoor_temperature
          name: Temperature
          show:
            extremas: true
        - entity: sensor.ws2900_v2_02_01_feels_like_temperature
          name: Ressentie
        - entity: sensor.ws2900_v2_02_01_windchill
          name: Refroidissement Eolien
        - entity: sensor.ws2900_v2_02_01_dewpoint
          name: Rosée
      view_layout:
        grid-area: c
    - type: custom:apexcharts-card
      config_templates:
        - meteo
      header:
        show: true
        title: Vent
        show_states: true
        colorize_states: true
      graph_span: 36h
      all_series_config:
        stroke_width: 1
        show:
          extremas: max
      series:
        - entity: sensor.ws2900_v2_02_01_wind_speed
          name: Vitesse
        - entity: sensor.ws2900_v2_02_01_wind_gust
          name: Rafale
          opacity: 0.2
          type: area
      view_layout:
        grid-area: d            
    - type: custom:apexcharts-card
      config_templates:
        - meteo
      header:
        show: true
        title: Pluie
        show_states: true
        colorize_states: true
      graph_span: 1d
      all_series_config:
        stroke_width: 1
        show:
          extremas: max
      yaxis:
        - id: rate
        - id: total
          opposite: true
      series:
        - entity: sensor.ws2900_v2_02_01_rain_rate
          name: Pluviométrie
          type: column
          stroke_width: 2
          yaxis_id: rate
          color: rebeccapurple
        - entity: sensor.ws2900_v2_02_01_total_rain
          yaxis_id: total
      view_layout:
        grid-area: e            
    - type: custom:apexcharts-card
      config_templates:
        - meteo
      header:
        show: true
        title: Pression
        show_states: true
        colorize_states: true
      graph_span: 2d
      all_series_config:
        stroke_width: 1
        show:
          extremas: true
      series:
        - entity: sensor.ws2900_v2_02_01_relative_pressure
          name: Pression
      view_layout:
        grid-area: f            
    - type: custom:apexcharts-card
      config_templates:
        - meteo
      header:
        show: true
        title: Humidité
        show_states: true
        colorize_states: true
      graph_span: 1d
      all_series_config:
        stroke_width: 1
        show:
          extremas: true
      series:
        - entity: sensor.ws2900_v2_02_01_humidity
          name: Humidité
      view_layout:
        grid-area: g            


###############################################################
# SUBVIEWS : Températures
###############################################################
  - type: custom:horizontal-layout
    title: Températures
    subview: true
    path: subview-temperatures
    back_path: /preview-dashboard/0
    layout:
      max_cols: 3
    cards:
      - type: thermostat
        entity: climate.kachafresh
      - type: entities
        show_header_toggle: false
        entities:
          - type: section
            label: Pièces
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a4800849a0_temperature
              - humidity: sensor.sonoff_a4800849a0_humidity
              - feels_like: sensor.temperature_ressentie_antre_cha
              - name: Antre Cha
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a4800849a3_temperature
              - humidity: sensor.sonoff_a4800849a3_humidity
              - feels_like: sensor.temperature_ressentie_antre_van              
              - name: Antre Vanessa
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a480085bf0_temperature
              - humidity: sensor.sonoff_a480085bf0_humidity
              - feels_like: sensor.temperature_ressentie_chambre              
              - name: Chambre à coucher
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a480085bef_temperature
              - humidity: sensor.sonoff_a480085bef_humidity
              - feels_like: sensor.temperature_ressentie_salle_de_bain              
              - name: Salle de bain
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a4800866c4_temperature
              - humidity: sensor.sonoff_a4800866c4_humidity
              - feels_like: sensor.temperature_ressentie_cellier              
              - name: Cellier
      - type: entities
        show_header_toggle: false
        entities:
          - type: section
            label: Zones
          - type: custom:decluttering-card
            template: temperature_with_feels_like
            variables:
              - entity: sensor.sonoff_a4800866c9_temperature
              - humidity: sensor.sonoff_a4800866c9_humidity
              - feels_like: sensor.temperature_ressentie_salon              
              - name: Rez-de-chaussée
          - type: custom:decluttering-card
            template: temperature
            variables:
              - entity: sensor.armoire_hwg_ste_temperature
              - name: Armoire informatique

###############################################################
# SUBVIEWS : Energie
###############################################################
  - type: custom:grid-layout
    title: Energie
    subview: true
    path: subview-energie
    back_path: /preview-dashboard/0
    layout:
      grid-template-columns: 1fr 1fr 1fr
      grid-template-rows: auto auto auto
      grid-template-areas: |-
        "a a b"
        "a a c"
        "d d d"
        "e e e"
      place-content: stretch
    cards:
      - type: energy-usage-graph
        view_layout:
          grid-area: a     
      - type: energy-distribution
        link_dashboard: true
        view_layout:
          grid-area: b       
      - type: energy-carbon-consumed-gauge
        view_layout:
          grid-area: c       
      - type: energy-sources-table
        view_layout:
          grid-area: d   
      - type: energy-devices-graph
        view_layout:
          grid-area: e                       
###############################################################
# Templates Button card 
###############################################################
button_card_templates:
  details:
    size: 2vw
    show_icon: false
    color: '#9da0a2'
    styles:
      card:
        - color: '#5567ab'
        - width: fit-content
        - border: 0.12vw solid rgba(115, 115, 115, 0.15)
        - transition: none
        - margin: 0
        - overflow: visible
    extra_styles: |
      #name {
        color: rgba(255, 255, 255);
        font-size: var(--tihiti-footer-card-font-size);
        letter-spacing: 0.05vw;
        opacity: 1.0;
      }

      ha-icon {
        width: 20px;
        vertical-align: 7%;
        padding-right: 0.2vw;
        color: rgba(255, 255, 255);
        opacity: 1.0;
      }

      #card {
        padding: var(--tihiti-footer-card-padding-v) var(--tihiti-footer-card-padding-h);
        border-radius: var(--ha-card-border-radius, 12px);
        margin: 0 auto;
        background: #5567ab;
      }

      /* Mobile */
      @media screen and (max-width: 992px) { 
        ha-card { 
          width: 100%;
          margin: 0 2vw;
        }

        #card { 
          padding: calc( var( --tihiti-footer-card-padding-v ) * 4.5 ) var( --tihiti-footer-card-padding-h );
          width: 100% !important;
        }
      }

##################################################
# Templates ApexCharts 
##################################################
apexcharts_card_templates:
  meteo:
    apex_config:
      legend:
        show: false
      grid:
        show: false
      xaxis:
        axisBorder:
          show: false
    all_series_config:
      stroke_width: 1