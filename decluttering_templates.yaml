#################################################
# Status batteries
#################################################
battery_states:
  card:
    type: "custom:mod-card"
    card_mod:
      style: |
        :host {
          position: absolute;
          bottom: 40px;
          right: 70px;
          width: 265px;
        }
    card:
      type: "custom:auto-entities"
      show_empty: false
      filter:
        include:
          - entity_id: '/sensor\..*battery/'
            state: "< 85"
        exclude:
          - entity_id: '/sensor\..*phone/'
          - entity_id: '/sensor\.panel_*/'
          - entity_id: '/sensor\..*_temperature/'
          - attributes:
              show_battery_alert: false
      card:
        type: entities
        theme: floorplan
        card_mod:
          style: |
            @keyframes alert {
              from {
                background: #ff000033;
                box-shadow: 0px 0px 0px 1px #f970709e;
              }
              to {
                background: #ff000011;
                box-shadow: 0px 0px 0px 1px #f9707055;
              }
            }
            ha-card {
              background: #ffffff14;
              height: auto !important;
              transform: translate( 0, 0 );
              
              box-shadow: 0px 0px 0px 1px #f970709e;
              background: #ff000066;
            }
###################################################
# Status porte et fenêtre
###################################################
door:
  default:
    - battery: 'false'
    - state: battery
    - icon_open: door-open
    - icon_closed: door-closed
    - icon_unknown: alert-circle-outline
  card:
    type: custom:mushroom-template-card
    entity: '[[entity]]'
    primary: '[[name]]'
    secondary: >-
      {% if '[[battery]]' != 'false' and not is_state( '[[battery]]',
      'unavailable' ) %}
        {% set state_battery = states( '[[battery]]' ) | lower %}
        Battery: {{ state_battery }}%
      {% else %}
        {% set state_entity = states( '[[entity]]' ) | lower %}
        {% if state_entity == 'on' %}
          Ouvert
        {% elif state_entity == 'off' %}
          Fermé
        {% else %}
          Inconnu
        {% endif %}
      {% endif %}
    icon: >-
      {% set ignore = ['null', 'unknown', 'unavailable'] %} {% set
      state_entity = states( '[[entity]]' ) | lower %}

      {% if state_entity in ignore %}
        mdi:alert-circle-outline
      {% elif state_entity == 'on' %}
        mdi:[[icon_open]]
      {% elif state_entity == 'off' %}
        mdi:[[icon_closed]]
      {% else %}
        mdi:alert-circle-outline
      {% endif %}
    icon_color: |-
      {% if '[[battery]]' != 'false' %}
        {% set state_battery = states( '[[battery]]' ) | int %}
        {% set state_entity = states( '[[entity]]' ) | lower %}

        {% if state_battery > 50 %}
          {%if state_entity == 'on' %}
            green
          {% else %}
            disabled
          {% endif %}
        {% elif state_battery > 40 %}
          yellow
        {% elif state_battery > 30 %}
          amber
        {% elif state_battery > 20 %}
          orange
        {% elif state_battery > 10 %}
          deep-orange
        {% else %}
          red
        {% endif %}
      {% else %}
        {% set state_entity = states( '[[entity]]' ) %}
        {% if state_entity == 'on' %}
          green
        {% else %}
          disabled
        {% endif %}
      {% endif %}
